<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Admin - Gestion Jeux</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#0f1220;
  color:white;
  font-family:Arial;
  padding:40px;
}

input, textarea {
  width:100%;
  padding:8px;
  margin-bottom:10px;
  border-radius:6px;
  border:none;
}

button {
  padding:8px 15px;
  margin-right:5px;
  border-radius:6px;
  border:2px solid #aab0ff;
  background:transparent;
  color:#aab0ff;
  cursor:pointer;
}

button:hover {
  background:#aab0ff;
  color:#0f1220;
}
</style>
</head>

<body>

<h1>Interface Admin</h1>

<button id="logoutBtn">DÃ©connexion</button>

<h2>Ajouter / Modifier un jeu</h2>

<input id="title" placeholder="Nom du jeu">
<input id="image" placeholder="URL image">
<input id="gif" placeholder="URL gif">

<textarea id="fact1" placeholder="Fait 1"></textarea>
<textarea id="fact2" placeholder="Fait 2"></textarea>
<textarea id="fact3" placeholder="Fait 3"></textarea>

<button id="saveBtn">Enregistrer</button>
<button id="cancelBtn">Annuler</button>

<hr>

<h2>Liste des jeux</h2>
<div id="gameList"></div>

<script type="module">

import { GameService } from "./gameService.js";
import { auth } from "./firebaseConfig.js";
import { onAuthStateChanged, signOut } from 
"https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

/* ========= PROTECTION ========= */

onAuthStateChanged(auth, user => {
  if (!user) {
    window.location.href = "login.html";
  }
});

/* ========= LOGOUT ========= */

document.getElementById("logoutBtn").addEventListener("click", async () => {
  await signOut(auth);
  window.location.href = "login.html";
});

/* ========= VARIABLES ========= */

let games = [];
let editId = null;

/* ========= CHARGEMENT ========= */

async function loadGames() {
  games = await GameService.getGames();
  renderList();
}

/* ========= SAVE ========= */

async function saveGame() {

  const title = document.getElementById("title").value;
  const image = document.getElementById("image").value;
  const gif = document.getElementById("gif").value;

  const facts = [
    document.getElementById("fact1").value,
    document.getElementById("fact2").value,
    document.getElementById("fact3").value
  ];

  const gameData = { title, image, gif, facts };

  if (editId) {
    await GameService.updateGame(editId, gameData);
    editId = null;
  } else {
    await GameService.addGame(gameData);
  }

  resetForm();
  loadGames();
}

/* ========= EDIT ========= */

function editGame(id) {

  const game = games.find(g => g.id === id);

  document.getElementById("title").value = game.title;
  document.getElementById("image").value = game.image;
  document.getElementById("gif").value = game.gif;
  document.getElementById("fact1").value = game.facts[0];
  document.getElementById("fact2").value = game.facts[1];
  document.getElementById("fact3").value = game.facts[2];

  editId = id;
}

/* ========= DELETE ========= */

async function deleteGame(id) {

  if (!confirm("Supprimer ce jeu ?")) return;

  await GameService.deleteGame(id);
  loadGames();
}

/* ========= RESET ========= */

function resetForm() {
  document.getElementById("title").value = "";
  document.getElementById("image").value = "";
  document.getElementById("gif").value = "";
  document.getElementById("fact1").value = "";
  document.getElementById("fact2").value = "";
  document.getElementById("fact3").value = "";
  editId = null;
}

/* ========= RENDER ========= */

function renderList() {

  const container = document.getElementById("gameList");

  container.innerHTML = games.map(game => `
    <div style="margin-bottom:10px; padding:10px; border:1px solid #333;">
      <strong>${game.title}</strong>
      <br>
      <button data-edit="${game.id}">Modifier</button>
      <button data-delete="${game.id}">Supprimer</button>
    </div>
  `).join("");

  document.querySelectorAll("[data-edit]").forEach(btn => {
    btn.addEventListener("click", () => editGame(btn.dataset.edit));
  });

  document.querySelectorAll("[data-delete]").forEach(btn => {
    btn.addEventListener("click", () => deleteGame(btn.dataset.delete));
  });
}

/* ========= EVENTS ========= */

document.getElementById("saveBtn").addEventListener("click", saveGame);
document.getElementById("cancelBtn").addEventListener("click", resetForm);

/* ========= INIT ========= */

loadGames();

</script>

</body>
</html>
